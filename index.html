<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Ladu Investment ERP | Construction Materials</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        [v-cloak] { display: none; }
        .odoo-sidebar { background-color: #714B67; width: 240px; }
        .odoo-active { background-color: rgba(255,255,255,0.12); border-left: 4px solid #00A09D; }
        .card-shadow { box-shadow: 0 2px 6px rgba(0,0,0,0.06); }
        .status-pill { padding: 4px 10px; border-radius: 999px; font-size: 10px; font-weight: 700; text-transform: uppercase; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .role-card { width: 120px; height: 120px; border-radius: 12px; display:flex; align-items:center; justify-content:center; cursor:pointer; transition: transform .12s; }
        .role-card:hover { transform: translateY(-6px); }
        .logo-ldi { font-weight: 900; font-size: 26px; letter-spacing: 2px; color: #714B67; }
        .sidebar-transition { transition: transform .18s ease-in-out, opacity .18s ease-in-out; }
    </style>
</head>
<body class="bg-gray-100 font-sans text-gray-800">
<div id="app" v-cloak class="min-h-screen">

    <!-- Landing / Role selector (only shown when not logged in) -->
    <!-- NOTE: On mobile the content will align to the very left (items-start justify-start),
         while on md+ screens it will center (md:items-center md:justify-center). -->
    <div v-if="!session" class="min-h-screen flex items-start md:items-center justify-start md:justify-center p-4 md:p-6">
        <div class="w-full max-w-2xl bg-white rounded-2xl shadow-lg p-6 grid grid-cols-1 gap-6">
            <div class="flex flex-col justify-start items-start gap-4">
                <div class="flex items-center gap-3 w-full">
                    <div class="w-14 h-14 rounded-lg bg-[#00A09D] flex items-center justify-center text-white font-black text-xl">LDI</div>
                    <div>
                        <h1 class="text-2xl font-black tracking-tight">Ladu <span class="text-[#714B67]">Investment</span></h1>
                        <p class="text-sm text-gray-500">ERP for Construction Materials — Access Management</p>
                    </div>
                </div>

                <p class="text-gray-600">Select your role to sign in. Each role opens a dedicated login form — use the username and password assigned to the user.</p>

                <div class="flex flex-wrap gap-4 mt-2">
                    <div @click="openRoleLogin('Admin')" class="role-card bg-[#FFF3F8] border border-[#FFDDEE]">
                        <div class="text-center">
                            <i class="fas fa-user-shield text-4xl text-[#714B67]"></i>
                            <div class="text-xs font-bold mt-2">Admin</div>
                        </div>
                    </div>

                    <div @click="openRoleLogin('Sales')" class="role-card bg-[#F0FDFA] border border-[#D6F6EE]">
                        <div class="text-center">
                            <i class="fas fa-user-tie text-4xl text-[#00A09D]"></i>
                            <div class="text-xs font-bold mt-2">Sales</div>
                        </div>
                    </div>

                    <div @click="openRoleLogin('Store')" class="role-card bg-[#FFF9F0] border border-[#FFF0CC]">
                        <div class="text-center">
                            <i class="fas fa-warehouse text-4xl text-[#FF8C42]"></i>
                            <div class="text-xs font-bold mt-2">Store</div>
                        </div>
                    </div>
                </div>

                <div class="mt-3 text-sm text-gray-500">
                    <p class="mb-2">Demo credentials (use these to sign in):</p>
                    <ul class="list-disc pl-5 text-xs text-gray-600">
                        <li>Admin — username: <span class="font-mono">admin123</span> password: <span class="font-mono">1234</span></li>
                        <li>Sales — username: <span class="font-mono">sale123</span> password: <span class="font-mono">1234</span></li>
                        <li>Store — username: <span class="font-mono">store123</span> password: <span class="font-mono">1234</span></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Role login modal -->
        <div v-if="roleLogin.show" class="fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-xl w-full max-w-md shadow-2xl overflow-hidden">
                <div class="p-4 bg-[#714B67] text-white flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded bg-white/10 flex items-center justify-center text-lg font-black">LDI</div>
                        <div>
                            <div class="font-black uppercase text-sm">Sign in as {{ roleLogin.role }}</div>
                            <div class="text-xs opacity-80">Enter username & password</div>
                        </div>
                    </div>
                    <button @click="closeRoleLogin" class="text-white text-xl">&times;</button>
                </div>

                <div class="p-6">
                    <div class="space-y-3">
                        <label class="text-xs font-bold uppercase text-gray-400">Username</label>
                        <input v-model="roleLogin.username" type="text" class="w-full border p-3 rounded bg-gray-50" placeholder="username">

                        <label class="text-xs font-bold uppercase text-gray-400">Password</label>
                        <input v-model="roleLogin.password" type="password" class="w-full border p-3 rounded bg-gray-50" placeholder="password">

                        <div v-if="roleLogin.error" class="text-red-600 text-sm font-bold">{{ roleLogin.error }}</div>

                        <div class="flex items-center justify-between">
                            <button @click="attemptRoleLogin" class="bg-[#00A09D] text-white px-4 py-2 rounded font-bold">Sign In</button>
                            <button @click="closeRoleLogin" class="text-sm text-gray-500">Cancel</button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Main app (shown when logged in) -->
    <div v-else class="flex h-screen overflow-hidden">
        <!-- Mobile backdrop when sidebar is open -->
        <div v-if="sidebarOpen" @click="sidebarOpen = false" class="fixed inset-0 bg-black/40 z-30 md:hidden"></div>

        <!-- Sidebar (responsive: fixed overlay on small screens, static on md+) -->
        <aside
            :class="[
                'odoo-sidebar text-white flex flex-col shrink-0 sidebar-transition',
                sidebarOpen ? 'translate-x-0 opacity-100' : '-translate-x-full opacity-0 md:translate-x-0 md:opacity-100',
                'fixed md:static inset-y-0 left-0 z-40 md:z-auto'
            ]"
            style="width:240px;"
        >
            <div class="p-6 text-xl font-bold border-b border-white/10 flex items-center gap-3">
                <div class="w-10 h-10 rounded bg-white/10 flex items-center justify-center text-white font-black">LDI</div>
                <div class="leading-none">
                    <div class="text-sm font-black">Ladu ERP</div>
                    <div class="text-[11px] opacity-70">Construction</div>
                </div>
            </div>
            <nav class="flex-1 mt-4">
                <button @click="view = 'dashboard'; sidebarOpen = false" :class="{'odoo-active': view === 'dashboard'}" class="w-full text-left p-4 flex items-center hover:bg-white/5">
                    <i class="fas fa-th-large w-8 text-teal-400"></i> Dashboard
                </button>
                <button v-if="['Admin','Sales'].includes(session.role)" @click="view = 'sales'; sidebarOpen = false" :class="{'odoo-active': view === 'sales'}" class="w-full text-left p-4 flex items-center hover:bg-white/5">
                    <i class="fas fa-shopping-cart w-8 text-teal-400"></i> Sales Order
                </button>
                <button v-if="['Admin','Store'].includes(session.role)" @click="view = 'inventory'; sidebarOpen = false" :class="{'odoo-active': view === 'inventory'}" class="w-full text-left p-4 flex items-center hover:bg-white/5">
                    <i class="fas fa-boxes w-8 text-teal-400"></i> Inventory
                </button>
                <button v-if="session.role === 'Admin'" @click="view = 'users'; sidebarOpen = false" :class="{'odoo-active': view === 'users'}" class="w-full text-left p-4 flex items-center hover:bg-white/5 transition">
                    <i class="fas fa-users-cog w-8 text-teal-400"></i> User Management
                </button>
                <button v-if="session.role === 'Admin' || session.role === 'Sales'" @click="view = 'reports'; sidebarOpen = false" :class="{'odoo-active': view === 'reports'}" class="w-full text-left p-4 flex items-center hover:bg-white/5">
                    <i class="fas fa-chart-line w-8 text-teal-400"></i> Reports
                </button>
            </nav>
            <div class="p-4 bg-black/20 text-xs">
                <p class="font-bold text-teal-300 uppercase">{{ session.role }}</p>
                <p class="opacity-60">{{ session.fullname }}</p>
                <button @click="logout" class="mt-2 text-red-300 hover:text-red-100 uppercase font-bold">Logout</button>
            </div>
        </aside>

        <!-- Main content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <header class="h-14 bg-white border-b px-4 md:px-8 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <!-- Mobile menu toggle -->
                    <button @click="sidebarOpen = !sidebarOpen" class="p-2 md:hidden bg-white/0 rounded-md border md:border-0">
                        <i class="fas fa-bars text-gray-600"></i>
                    </button>
                    <h2 class="text-lg font-bold text-gray-700 capitalize">{{ view }}</h2>
                </div>

                <div class="flex items-center gap-4">
                    <div class="relative group cursor-pointer" @click="showNotifs = !showNotifs">
                        <i class="fas fa-bell text-gray-400 text-lg"></i>
                        <span v-if="notifs.length > 0" class="absolute -top-2 -right-2 bg-red-600 text-white text-[10px] w-4 h-4 rounded-full flex items-center justify-center font-bold">{{ notifs.length }}</span>
                    </div>
                    <div class="cursor-pointer" @click="showChat = !showChat">
                        <i class="fas fa-comment-alt text-gray-400 text-lg"></i>
                    </div>
                    <button v-if="['sales','inventory','users'].includes(view)" @click="openActionModal" class="bg-[#00A09D] hover:bg-[#008a87] text-white px-4 md:px-5 py-1.5 rounded font-bold text-sm shadow-sm">
                        <i class="fas fa-plus mr-2"></i> Create
                    </button>
                </div>
            </header>

            <main class="flex-1 overflow-y-auto p-4 md:p-6 scrollbar-hide">
                <div v-if="view === 'dashboard'">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div v-if="session.role === 'Admin'" class="bg-white p-4 rounded-lg border card-shadow">
                            <p class="text-[10px] font-bold text-gray-400 uppercase">Valuation</p>
                            <p class="text-lg font-black text-gray-700">₦{{ formatMoney(18500000) }}</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg border card-shadow border-l-4 border-red-500">
                            <p class="text-[10px] font-bold text-gray-400 uppercase">Low Stock Alerts</p>
                            <p class="text-lg font-black text-red-600">{{ lowStockProducts.length }} SKUs</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg border card-shadow">
                            <p class="text-[10px] font-bold text-gray-400 uppercase">Today's Sales</p>
                            <p class="text-lg font-black text-gray-700">₦{{ formatMoney(todaySales) }}</p>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg border card-shadow overflow-hidden">
                        <div class="p-3 border-b font-bold text-sm text-gray-600 bg-gray-50">Active Sales Orders</div>
                        <table class="w-full text-left">
                            <thead class="bg-white text-[10px] uppercase font-bold text-gray-400 border-b">
                                <tr><th class="p-3">Ref</th><th class="p-3">Customer</th><th class="p-3">Amount</th><th class="p-3">Status</th></tr>
                            </thead>
                            <tbody class="text-xs">
                                <tr v-for="o in orders.slice(0, 8)" class="border-b hover:bg-gray-50">
                                    <td class="p-3 font-bold text-[#714B67]">{{ o.id }}</td>
                                    <td class="p-3">{{ o.customer }}</td>
                                    <td class="p-3 font-bold">₦{{ formatMoney(o.total) }}</td>
                                    <td class="p-3"><span :class="statusClass(o.status)" class="status-pill">{{ o.status }}</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Inventory -->
                <div v-if="view === 'inventory'" class="bg-white rounded-lg border card-shadow overflow-hidden">
                    <table class="w-full text-left">
                        <thead class="bg-gray-50 text-[10px] font-bold uppercase text-gray-400 border-b">
                            <tr><th class="p-4">Product</th><th class="p-4">Category</th><th class="p-4">Stock</th><th class="p-4 text-right">Unit Price</th><th class="p-4 text-center">Actions</th></tr>
                        </thead>
                        <tbody class="text-sm">
                            <tr v-for="(p, index) in products" class="border-b">
                                <td class="p-4 font-bold">{{ p.name }}</td>
                                <td class="p-4 text-xs font-bold uppercase opacity-50">{{ p.category }}</td>
                                <td class="p-4">
                                    <span :class="p.stock < 20 ? 'text-red-600 font-black' : 'font-bold'">{{ p.stock }} {{ p.unit }}</span>
                                </td>
                                <td class="p-4 text-right">₦{{ formatMoney(p.price) }}</td>
                                <td class="p-4 text-center space-x-3">
                                    <button @click="editProduct(p)" class="text-[#00A09D] hover:underline font-bold text-xs">Update</button>
                                    <button v-if="session.role === 'Admin'" @click="deleteProduct(index)" class="text-red-500 hover:underline font-bold text-xs">Delete</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Sales -->
                <div v-if="view === 'sales'" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div v-for="st in ['quotation','confirmed','delivered']" class="bg-gray-200/40 p-4 rounded-xl">
                        <h4 class="text-[10px] font-black uppercase text-gray-500 mb-4 px-2">{{ st }}</h4>
                        <div v-for="o in orders.filter(x => x.status === st)" class="bg-white p-4 rounded-lg shadow-sm border-b-2 border-teal-600 mb-4 hover:shadow-md transition">
                            <div class="flex justify-between">
                                <p class="font-bold text-sm">{{ o.customer }}</p>
                                <span class="text-[10px] text-gray-400">#{{ o.id }}</span>
                            </div>
                            <p class="font-black text-gray-700 mt-2">₦{{ formatMoney(o.total) }}</p>
                            <div class="mt-2 text-xs text-gray-500">Date: {{ formatDate(o.created_at) }}</div>

                            <div class="mt-4 pt-3 border-t flex justify-end">
                                <button v-if="o.status === 'quotation'" @click="updateOrderStatus(o,'confirmed')" class="text-[10px] bg-blue-600 text-white px-3 py-1 rounded font-bold uppercase">Confirm Order</button>
                                <button v-if="o.status === 'confirmed'" @click="updateOrderStatus(o,'delivered')" class="text-[10px] bg-green-600 text-white px-3 py-1 rounded font-bold uppercase">Mark Delivered</button>
                                <span v-if="o.status === 'delivered'" class="text-[10px] text-green-600 font-bold uppercase"><i class="fas fa-check-circle"></i> Completed</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Users -->
                <div v-if="view === 'users'" class="bg-white rounded-lg border card-shadow">
                    <table class="w-full text-left">
                        <thead class="bg-gray-50 text-[10px] font-bold border-b">
                            <tr><th class="p-4 uppercase text-gray-400">Full Name</th><th class="p-4 uppercase text-gray-400">Username</th><th class="p-4 uppercase text-gray-400">Role</th><th class="p-4 uppercase text-gray-400 text-center">Action</th></tr>
                        </thead>
                        <tbody>
                            <tr v-for="(u, idx) in users" class="border-b">
                                <td class="p-4 font-bold">{{ u.fullname }}</td>
                                <td class="p-4 font-mono text-sm">{{ u.username }}</td>
                                <td class="p-4 text-xs">{{ u.role }}</td>
                                <td class="p-4 text-center">
                                    <button @click="deleteUser(idx)" class="text-red-500 hover:text-red-700 font-bold text-xs"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Reports -->
                <div v-if="view === 'reports'" class="space-y-6">
                    <div class="bg-white p-6 rounded-lg border card-shadow flex flex-wrap gap-4 items-end">
                        <div class="w-full sm:w-56">
                            <label class="text-[10px] font-bold uppercase text-gray-400">Product</label>
                            <select v-model="report.product" class="w-full border p-2 rounded text-sm bg-gray-50">
                                <option value="__all__">All Products</option>
                                <option v-for="p in products" :value="p.name">{{ p.name }}</option>
                            </select>
                        </div>

                        <div class="w-full sm:w-48">
                            <label class="text-[10px] font-bold uppercase text-gray-400">Date From</label>
                            <input type="date" v-model="report.date_from" class="w-full border p-2 rounded text-sm bg-gray-50">
                        </div>

                        <div class="w-full sm:w-48">
                            <label class="text-[10px] font-bold uppercase text-gray-400">Date To</label>
                            <input type="date" v-model="report.date_to" class="w-full border p-2 rounded text-sm bg-gray-50">
                        </div>

                        <button @click="generateReport" class="bg-[#00A09D] text-white px-4 py-2 rounded font-bold text-sm">
                            <i class="fas fa-filter mr-2"></i> Generate
                        </button>

                        <button @click="exportReport('PDF')" class="bg-red-600 text-white px-4 py-2 rounded font-bold text-sm">
                            <i class="fas fa-file-pdf mr-2"></i> Export PDF
                        </button>
                        <button @click="exportReport('Excel')" class="bg-green-700 text-white px-4 py-2 rounded font-bold text-sm">
                            <i class="fas fa-file-excel mr-2"></i> Export Excel
                        </button>
                    </div>

                    <div class="bg-white p-6 border card-shadow min-h-[300px]">
                        <div class="flex justify-between items-start border-b-2 pb-6 mb-6">
                            <div>
                                <h1 class="text-2xl font-black uppercase text-[#714B67]">Ladu Investment Ltd.</h1>
                                <p class="text-xs text-gray-500">Construction Materials & Equipment - Nigeria</p>
                            </div>
                            <div class="text-right text-xs">
                                <p>Date: {{ formatDate(new Date().toISOString()) }}</p>
                                <p>Report Ref: #RPT-{{ Math.floor(100 + Math.random()*900) }}</p>
                            </div>
                        </div>

                        <h2 class="text-center font-bold uppercase mb-6">Periodic Sales Performance Report</h2>

                        <div v-if="reportResults.totalQty === 0" class="text-center text-gray-500 py-10">
                            No data for selected range / product.
                        </div>

                        <div v-else>
                            <table class="w-full text-sm border">
                                <thead>
                                    <tr class="bg-gray-100"><th class="p-2 border">Item</th><th class="p-2 border">Qty</th><th class="p-2 border text-right">Total Amount</th></tr>
                                </thead>
                                <tbody>
                                    <tr v-for="r in reportResults.items" :key="r.name">
                                        <td class="p-2 border">{{ r.name }}</td>
                                        <td class="p-2 border text-center">{{ r.qty }}</td>
                                        <td class="p-2 border text-right">₦{{ formatMoney(r.amount) }}</td>
                                    </tr>
                                    <tr class="font-bold bg-gray-50">
                                        <td colspan="2" class="p-2 border text-right">GRAND TOTAL</td>
                                        <td class="p-2 border text-right">₦{{ formatMoney(reportResults.totalAmount) }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>

            </main>
        </div>
    </div>

    <!-- Notifications -->
    <div v-if="showNotifs" class="fixed right-4 md:right-20 top-16 w-80 bg-white shadow-2xl rounded-lg border z-[300] overflow-hidden">
        <div class="p-3 bg-gray-50 border-b font-bold text-xs uppercase text-gray-500">Notifications</div>
        <div class="max-h-64 overflow-y-auto">
            <div v-for="n in notifs" class="p-4 border-b hover:bg-gray-50 text-xs">
                <p class="font-bold text-gray-700">{{ n.title }}</p>
                <p class="text-gray-500 mt-1">{{ n.msg }}</p>
            </div>
        </div>
        <button @click="notifs = []" class="w-full p-2 text-[10px] font-bold text-teal-600 uppercase hover:bg-gray-100">Clear All</button>
    </div>

    <!-- Chat -->
    <div v-if="showChat" class="fixed right-4 md:right-8 bottom-4 md:bottom-8 w-80 bg-white shadow-2xl rounded-t-xl border z-[300] overflow-hidden flex flex-col">
        <div class="p-4 bg-[#714B67] text-white flex justify-between items-center">
            <span class="font-bold text-sm">Internal Communication</span>
            <button @click="showChat = false">&times;</button>
        </div>
        <div class="h-64 p-4 overflow-y-auto space-y-3 bg-gray-50 flex flex-col">
            <div v-for="m in messages" :class="m.from === session.fullname ? 'self-end bg-teal-600 text-white' : 'self-start bg-white text-gray-700 border'" class="p-2 rounded-lg text-xs max-w-[80%]">
                <p class="font-black text-[9px] uppercase opacity-70">{{ m.from }}</p>
                {{ m.text }}
            </div>
        </div>
        <div class="p-3 border-t flex gap-2">
            <input v-model="newMessage" @keyup.enter="sendMessage" type="text" placeholder="Type message..." class="flex-1 text-xs border rounded p-2 outline-none">
            <button @click="sendMessage" class="bg-[#00A09D] text-white px-3 rounded"><i class="fas fa-paper-plane text-xs"></i></button>
        </div>
    </div>

    <!-- Generic modal for create/update -->
    <div v-if="modal.show" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[400] flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-lg rounded-xl shadow-2xl overflow-hidden">
            <div class="p-6 bg-[#714B67] text-white flex justify-between items-center">
                <h3 class="font-black uppercase tracking-widest text-sm">{{ modal.isEdit ? 'Update' : 'Create New' }} {{ view === 'users' ? 'User' : view.slice(0,1).toUpperCase() + view.slice(1) }}</h3>
                <button @click="modal.show = false" class="text-xl">&times;</button>
            </div>
            <div class="p-8 space-y-4">
                <div v-if="view === 'sales'">
                    <label class="block text-[10px] font-bold text-gray-400 uppercase">Customer</label>
                    <input v-model="form.customer" type="text" class="w-full border p-3 rounded bg-gray-50">
                    <div class="grid grid-cols-2 gap-4 mt-4">
                        <div>
                            <label class="block text-[10px] font-bold text-gray-400 uppercase">Amount</label>
                            <input v-model.number="form.total" type="number" class="w-full border p-3 rounded bg-gray-50">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-gray-400 uppercase">Order Status</label>
                            <select v-model="form.status" class="w-full border p-3 rounded bg-gray-50">
                                <option value="quotation">Quotation</option>
                                <option value="confirmed">Confirmed</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div v-if="view === 'inventory'">
                    <label class="block text-[10px] font-bold text-gray-400 uppercase">Product Name</label>
                    <input v-model="form.pName" type="text" class="w-full border p-3 rounded bg-gray-50">
                    <div class="grid grid-cols-2 gap-4 mt-4">
                        <div>
                            <label class="block text-[10px] font-bold text-gray-400 uppercase">Quantity (Stock)</label>
                            <input v-model.number="form.stock" type="number" class="w-full border p-3 rounded bg-gray-50">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-gray-400 uppercase">Unit Price (₦)</label>
                            <input v-model.number="form.price" type="number" class="w-full border p-3 rounded bg-gray-50">
                        </div>
                    </div>
                </div>

                <div v-if="view === 'users'">
                    <label class="block text-[10px] font-bold text-gray-400 uppercase">Full Name</label>
                    <input v-model="form.uFullname" type="text" class="w-full border p-3 rounded bg-gray-50">

                    <label class="block text-[10px] font-bold text-gray-400 uppercase mt-4">Username</label>
                    <input v-model="form.uUsername" type="text" class="w-full border p-3 rounded bg-gray-50" placeholder="unique username">

                    <label class="block text-[10px] font-bold text-gray-400 uppercase mt-4">Password (assign)</label>
                    <input v-model="form.uPassword" type="password" class="w-full border p-3 rounded bg-gray-50" placeholder="temporary password">

                    <label class="block text-[10px] font-bold text-gray-400 uppercase mt-4">System Role</label>
                    <select v-model="form.uRole" class="w-full border p-3 rounded bg-gray-50">
                        <option value="Admin">Admin</option>
                        <option value="Sales">Sales</option>
                        <option value="Store">Store</option>
                    </select>

                    <div v-if="modal.userError" class="text-red-600 text-sm font-bold mt-2">{{ modal.userError }}</div>
                </div>

                <button @click="submitRecord" class="w-full py-4 bg-[#00A09D] text-white rounded-lg font-black uppercase tracking-widest shadow-lg">
                    {{ modal.isEdit ? 'Update Database' : 'Save Record' }}
                </button>
            </div>
        </div>
    </div>

</div>

<script>
    const { createApp } = Vue;
    createApp({
        data() {
            return {
                session: null,
                view: 'dashboard',
                sidebarOpen: false,
                showNotifs: false, showChat: false,
                modal: { show: false, isEdit: false, activeIndex: null, userError: '' },
                newMessage: '',
                form: { customer: '', total: 0, status: 'quotation', pName: '', stock: 0, price: 0, uFullname: '', uUsername: '', uPassword: '', uRole: 'Sales' },
                roleLogin: { show: false, role: null, username: '', password: '', error: '' },

                // demo users per your request
                users: [
                    { fullname: 'Administrator', username: 'admin123', password: '1234', role: 'Admin' },
                    { fullname: 'Sales User', username: 'sale123', password: '1234', role: 'Sales' },
                    { fullname: 'Store User', username: 'store123', password: '1234', role: 'Store' }
                ],

                notifs: [
                    { title: 'Stock Alert', msg: '10mm Steel Rod is below 10 bundles!' },
                    { title: 'Payment', msg: 'SO003 payment confirmed by Admin.' }
                ],
                messages: [
                    { from: 'Musa Ibrahim', text: 'Truck for Cement arrived.' },
                    { from: 'Kemi Adebayo', text: 'Preparing quotation for Site C.' }
                ],

                products: [
                    { name: 'Dangote Cement (50kg)', category: 'Cement', stock: 450, unit: 'bags', price: 8500 },
                    { name: '10mm Steel Rod', category: 'Rods', stock: 8, unit: 'bundles', price: 720000 },
                    { name: 'River Sand (per ton)', category: 'Aggregates', stock: 65, unit: 'tons', price: 18000 }
                ],

                orders: [
                    { id: 'SO001', customer: 'Julius Berger', items: [{name:'Dangote Cement (50kg)', qty:150, amount:1275000}], total: 1275000, status: 'confirmed', created_at: '2026-01-18' },
                    { id: 'SO002', customer: 'Alhaji Gafar', items: [{name:'10mm Steel Rod', qty:2, amount:1900000}], total: 1900000, status: 'quotation', created_at: '2026-01-20' },
                    { id: 'SO003', customer: 'M. Construction', items: [{name:'Dangote Cement (50kg)', qty:50, amount:425000}], total: 425000, status: 'delivered', created_at: '2026-01-12' }
                ],

                report: { product: '__all__', date_from: '', date_to: ''},
                reportResults: { items: [], totalQty: 0, totalAmount: 0 }
            }
        },
        computed: {
            lowStockProducts() { return this.products.filter(p => p.stock < 20); },
            todaySales() {
                const today = new Date().toISOString().slice(0,10);
                return this.orders.filter(o => o.created_at === today).reduce((s,o)=>s+o.total,0);
            }
        },
        methods: {
            openRoleLogin(role) {
                this.roleLogin.show = true;
                this.roleLogin.role = role;
                this.roleLogin.username = '';
                this.roleLogin.password = '';
                this.roleLogin.error = '';
            },
            closeRoleLogin() {
                this.roleLogin.show = false;
                this.roleLogin.role = null;
                this.roleLogin.error = '';
            },
            attemptRoleLogin() {
                this.roleLogin.error = '';
                const u = this.users.find(x => x.username === this.roleLogin.username && x.password === this.roleLogin.password && x.role === this.roleLogin.role);
                if (!u) {
                    this.roleLogin.error = 'Invalid credentials for selected role.';
                    return;
                }
                this.session = { username: u.username, role: u.role, fullname: u.fullname };
                this.roleLogin.show = false;
                this.view = 'dashboard';
                this.sidebarOpen = false;
                this.checkStockAlerts();
            },
            logout() { this.session = null; this.view = 'dashboard'; this.sidebarOpen = false; },

            formatMoney(val) { if (!val && val !== 0) return '0'; return Number(val).toLocaleString(); },
            formatDate(d) { if(!d) return ''; return new Date(d).toLocaleDateString(); },

            statusClass(s) {
                const map = { quotation: 'bg-gray-100 text-gray-500', confirmed: 'bg-blue-100 text-blue-600', delivered: 'bg-green-100 text-green-600' };
                return map[s] || 'bg-gray-100 text-gray-500';
            },

            openActionModal() {
                this.modal.userError = '';
                this.modal.isEdit = false;
                this.modal.activeIndex = null;
                this.form = { customer: '', total: 0, status: 'quotation', pName: '', stock: 0, price: 0, uFullname: '', uUsername: '', uPassword: '', uRole: 'Sales' };
                this.modal.show = true;
            },

            updateOrderStatus(order, next) {
                order.status = next;
                this.notifs.unshift({ title: 'Order Updated', msg: `${order.id} is now ${next}` });
            },

            editProduct(p) {
                this.modal.isEdit = true;
                this.modal.activeIndex = this.products.indexOf(p);
                this.form = { pName: p.name, stock: p.stock, price: p.price };
                this.view = 'inventory';
                this.modal.show = true;
            },

            deleteProduct(idx) { if(confirm('Delete product?')) this.products.splice(idx,1); },

            deleteUser(idx) { if(confirm('Remove user access?')) this.users.splice(idx,1); },

            sendMessage() {
                if(!this.newMessage) return;
                this.messages.push({ from: this.session.fullname, text: this.newMessage });
                this.newMessage = '';
            },

            checkStockAlerts() {
                this.lowStockProducts.forEach(p => {
                    this.notifs.unshift({ title: 'Low Stock Alert', msg: `${p.name} only has ${p.stock} remaining!` });
                });
            },

            exportReport(type) {
                const summary = `Exporting ${type} for ${this.report.product === '__all__' ? 'All Products' : this.report.product} from ${this.report.date_from || 'start'} to ${this.report.date_to || 'end'} — Total: ₦${this.formatMoney(this.reportResults.totalAmount)}`;
                alert(summary);
            },

            submitRecord() {
                if (this.view === 'sales') {
                    const id = 'SO' + Math.floor(100 + Math.random() * 900);
                    const created = new Date().toISOString().slice(0,10);
                    const itemName = this.form.itemName || (this.products[0] && this.products[0].name) || 'Misc';
                    const item = { name: itemName, qty: 1, amount: this.form.total };
                    this.orders.unshift({ id, customer: this.form.customer, items: [item], total: this.form.total, status: this.form.status, created_at: created });
                } else if (this.view === 'inventory') {
                    if (this.modal.isEdit && this.modal.activeIndex !== null) {
                        const p = this.products[this.modal.activeIndex];
                        p.name = this.form.pName; p.stock = this.form.stock; p.price = this.form.price;
                    } else {
                        this.products.unshift({ name: this.form.pName, category: 'General', stock: this.form.stock, unit: 'units', price: this.form.price });
                    }
                } else if (this.view === 'users') {
                    this.modal.userError = '';
                    if(!this.form.uFullname || !this.form.uUsername || !this.form.uPassword) {
                        this.modal.userError = 'Fullname, username and password are required.';
                        return;
                    }
                    if (this.users.find(u => u.username === this.form.uUsername)) {
                        this.modal.userError = 'Username already exists. Choose another.';
                        return;
                    }
                    this.users.push({ fullname: this.form.uFullname, username: this.form.uUsername, password: this.form.uPassword, role: this.form.uRole });
                }
                this.modal.show = false;
                this.checkStockAlerts();
            },

            generateReport() {
                const from = this.report.date_from ? new Date(this.report.date_from) : null;
                const to = this.report.date_to ? new Date(this.report.date_to) : null;

                const aggr = {};
                let totalQty = 0, totalAmount = 0;
                this.orders.forEach(o => {
                    const d = new Date(o.created_at);
                    if (from && d < from) return;
                    if (to && d > to) return;

                    o.items.forEach(it => {
                        if (this.report.product !== '__all__' && it.name !== this.report.product) return;
                        if (!aggr[it.name]) aggr[it.name] = { name: it.name, qty: 0, amount: 0 };
                        aggr[it.name].qty += it.qty;
                        aggr[it.name].amount += it.amount;
                        totalQty += it.qty;
                        totalAmount += it.amount;
                    });
                });

                this.reportResults.items = Object.values(aggr);
                this.reportResults.totalQty = totalQty;
                this.reportResults.totalAmount = totalAmount;
            }
        }
    }).mount('#app');
</script>
</body>
</html>
