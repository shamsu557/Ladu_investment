<!DOCTYPE html>
<html lang="en" style="height: auto; min-height: 100%;">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Ladu Investment ERP</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        [v-cloak] { display: none; }
        
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up { animation: fadeInUp 0.2s ease-out; }

        @media print {
            body * { visibility: hidden; }
            #printReceipt, #printReceipt * { visibility: visible; }
            #printReceipt { position: absolute; left: 0; top: 0; width: 100%; }
        }
    </style>
</head>
<body style="height: auto; min-height: 100%;">

<div id="app" v-cloak class="flex flex-col min-h-screen">

    <!-- LOGIN SCREEN -->
    <div v-if="!session" class="min-h-screen flex flex-col items-center justify-center p-4 md:p-8 bg-gray-100">
        <div class="w-full max-w-4xl bg-white rounded-2xl shadow-xl overflow-hidden flex flex-col md:flex-row">
            <div class="md:w-5/12 bg-[#714B67] p-8 text-white flex flex-col justify-between relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none">
                    <i class="fas fa-cubes text-[200px] absolute -bottom-10 -right-10"></i>
                </div>
                <div class="relative z-10">
                    <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center text-xl font-black mb-6">LDI</div>
                    <h1 class="text-3xl font-black leading-tight mb-2">Ladu<br>Investment</h1>
                    <p class="text-white/70 text-sm">Enterprise Resource Planning for Construction Materials</p>
                </div>
                <div class="relative z-10 mt-12 md:mt-0">
                    <p class="text-xs font-bold uppercase tracking-widest opacity-50">System Access</p>
                    <div class="mt-2 text-sm opacity-80">Secure access management for Admin, Sales, and Inventory operations.</div>
                </div>
            </div>

            <div class="md:w-7/12 p-8 md:p-12">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Welcome Back</h2>
                <p class="text-gray-500 mb-8">Please select your role to continue.</p>

                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-8">
                    <button @click="openRoleLogin('Admin')" class="group p-4 rounded-xl border border-gray-200 hover:border-[#714B67] hover:bg-[#FFF3F8] transition text-center flex flex-col items-center gap-3">
                        <div class="w-12 h-12 rounded-full bg-gray-100 group-hover:bg-white flex items-center justify-center text-[#714B67] text-xl transition">
                            <i class="fas fa-user-shield"></i>
                        </div>
                        <span class="font-bold text-sm text-gray-700 group-hover:text-[#714B67]">Admin</span>
                    </button>

                    <button @click="openRoleLogin('Sales')" class="group p-4 rounded-xl border border-gray-200 hover:border-[#00A09D] hover:bg-[#F0FDFA] transition text-center flex flex-col items-center gap-3">
                        <div class="w-12 h-12 rounded-full bg-gray-100 group-hover:bg-white flex items-center justify-center text-[#00A09D] text-xl transition">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <span class="font-bold text-sm text-gray-700 group-hover:text-[#00A09D]">Sales</span>
                    </button>

                    <button @click="openRoleLogin('Store')" class="group p-4 rounded-xl border border-gray-200 hover:border-[#FF8C42] hover:bg-[#FFF9F0] transition text-center flex flex-col items-center gap-3">
                        <div class="w-12 h-12 rounded-full bg-gray-100 group-hover:bg-white flex items-center justify-center text-[#FF8C42] text-xl transition">
                            <i class="fas fa-warehouse"></i>
                        </div>
                        <span class="font-bold text-sm text-gray-700 group-hover:text-[#FF8C42]">Store</span>
                    </button>
                </div>

                <div class="bg-gray-50 rounded-lg p-4 text-xs text-gray-500 border border-gray-100">
                    <p class="font-bold mb-2 text-gray-400 uppercase">Demo Credentials</p>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-2">
                        <div><span class="font-bold">Admin:</span> admin123 / 1234</div>
                        <div><span class="font-bold">Sales:</span> sale123 / 1234</div>
                        <div><span class="font-bold">Store:</span> store123 / 1234</div>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="roleLogin.show" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm overflow-hidden animate-fade-in-up">
                <div class="bg-[#714B67] p-6 text-white flex justify-between items-start">
                    <div>
                        <h3 class="font-bold text-lg">Sign in as {{ roleLogin.role }}</h3>
                        <p class="text-white/70 text-xs mt-1">Enter your credentials to access the dashboard.</p>
                    </div>
                    <button @click="closeRoleLogin" class="text-white/70 hover:text-white"><i class="fas fa-times"></i></button>
                </div>
                <div class="p-6 space-y-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Username</label>
                        <div class="relative">
                            <i class="fas fa-user absolute left-3 top-3 text-gray-400 text-sm"></i>
                            <input v-model="roleLogin.username" type="text" class="w-full pl-9 pr-3 py-2.5 border rounded-lg text-sm focus:ring-2 focus:ring-[#714B67] focus:border-[#714B67] outline-none" placeholder="Enter username">
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Password</label>
                        <div class="relative">
                            <i class="fas fa-lock absolute left-3 top-3 text-gray-400 text-sm"></i>
                            <input v-model="roleLogin.password" type="password" @keyup.enter="attemptRoleLogin" class="w-full pl-9 pr-3 py-2.5 border rounded-lg text-sm focus:ring-2 focus:ring-[#714B67] focus:border-[#714B67] outline-none" placeholder="Enter password">
                        </div>
                    </div>

                    <div v-if="roleLogin.error" class="p-3 bg-red-50 text-red-600 text-xs font-bold rounded flex items-center gap-2">
                        <i class="fas fa-exclamation-circle"></i> {{ roleLogin.error }}
                    </div>

                    <button @click="attemptRoleLogin" class="w-full bg-[#00A09D] hover:bg-[#008a87] text-white font-bold py-3 rounded-lg shadow-lg shadow-teal-500/30 transition transform active:scale-95">
                        Access Dashboard
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- DASHBOARD LAYOUT -->
    <div v-else class="flex flex-col md:flex-row min-h-screen bg-gray-100">
        
        <div v-if="sidebarOpen" @click="sidebarOpen = false" class="fixed inset-0 bg-black/50 z-40 md:hidden"></div>

        <aside :class="['fixed md:static inset-y-0 left-0 z-50 w-64 bg-[#2A1B26] text-white flex flex-col transition-transform duration-300 ease-in-out shadow-2xl md:shadow-none', sidebarOpen ? 'translate-x-0' : '-translate-x-full md:translate-x-0']">
            <div class="h-16 flex items-center px-6 border-b border-white/10 bg-[#714B67]">
                <div class="w-8 h-8 rounded bg-white/20 flex items-center justify-center text-white font-black text-xs mr-3">LDI</div>
                <div>
                    <div class="font-bold text-sm tracking-wide">Ladu ERP</div>
                    <div class="text-[10px] text-white/60 uppercase tracking-wider">Construction</div>
                </div>
            </div>

            <nav class="flex-1 overflow-y-auto py-6 px-3 space-y-1">
                <a href="#" @click.prevent="view = 'dashboard'; sidebarOpen = false" :class="['flex items-center px-3 py-3 rounded-lg text-sm font-medium transition-colors', view === 'dashboard' ? 'bg-[#00A09D] text-white shadow-lg shadow-teal-900/20' : 'text-gray-300 hover:bg-white/5 hover:text-white']">
                    <i class="fas fa-th-large w-8 text-center"></i> Dashboard
                </a>
                
                <a v-if="['Admin','Sales'].includes(session.role)" href="#" @click.prevent="view = 'sales'; sidebarOpen = false" :class="['flex items-center px-3 py-3 rounded-lg text-sm font-medium transition-colors', view === 'sales' ? 'bg-[#00A09D] text-white shadow-lg shadow-teal-900/20' : 'text-gray-300 hover:bg-white/5 hover:text-white']">
                    <i class="fas fa-shopping-cart w-8 text-center"></i> Sales Orders
                </a>
                
                <a v-if="['Admin','Store'].includes(session.role)" href="#" @click.prevent="view = 'inventory'; sidebarOpen = false" :class="['flex items-center px-3 py-3 rounded-lg text-sm font-medium transition-colors', view === 'inventory' ? 'bg-[#00A09D] text-white shadow-lg shadow-teal-900/20' : 'text-gray-300 hover:bg-white/5 hover:text-white']">
                    <i class="fas fa-boxes w-8 text-center"></i> Inventory
                </a>

                <a v-if="session.role === 'Admin'" href="#" @click.prevent="view = 'expenses'; sidebarOpen = false" :class="['flex items-center px-3 py-3 rounded-lg text-sm font-medium transition-colors', view === 'expenses' ? 'bg-[#00A09D] text-white shadow-lg shadow-teal-900/20' : 'text-gray-300 hover:bg-white/5 hover:text-white']">
                    <i class="fas fa-receipt w-8 text-center"></i> Expenses
                </a>
                
                <a v-if="session.role === 'Admin'" href="#" @click.prevent="view = 'users'; sidebarOpen = false" :class="['flex items-center px-3 py-3 rounded-lg text-sm font-medium transition-colors', view === 'users' ? 'bg-[#00A09D] text-white shadow-lg shadow-teal-900/20' : 'text-gray-300 hover:bg-white/5 hover:text-white']">
                    <i class="fas fa-users-cog w-8 text-center"></i> User Management
                </a>
                
                <a v-if="['Admin','Sales'].includes(session.role)" href="#" @click.prevent="view = 'reports'; sidebarOpen = false" :class="['flex items-center px-3 py-3 rounded-lg text-sm font-medium transition-colors', view === 'reports' ? 'bg-[#00A09D] text-white shadow-lg shadow-teal-900/20' : 'text-gray-300 hover:bg-white/5 hover:text-white']">
                    <i class="fas fa-chart-pie w-8 text-center"></i> Reports
                </a>
            </nav>

            <div class="p-4 bg-black/20 border-t border-white/5">
                <div class="flex items-center gap-3 mb-3">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-[#00A09D] to-[#714B67] flex items-center justify-center text-xs font-bold shadow-inner">
                        {{ session.fullname.charAt(0) }}
                    </div>
                    <div class="overflow-hidden">
                        <div class="text-sm font-bold truncate">{{ session.fullname }}</div>
                        <div class="text-[10px] text-gray-400 uppercase tracking-wider">{{ session.role }}</div>
                    </div>
                </div>
                <button @click="logout" class="w-full py-2 text-xs font-bold text-red-300 hover:text-white hover:bg-red-500/20 rounded transition border border-red-500/20">
                    <i class="fas fa-sign-out-alt mr-2"></i> Sign Out
                </button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col min-w-0 bg-gray-50">
            <header class="h-16 bg-white border-b border-gray-200 flex items-center justify-between px-4 md:px-8 sticky top-0 z-30 shadow-sm">
                <div class="flex items-center gap-4">
                    <button @click="sidebarOpen = !sidebarOpen" class="md:hidden p-2 text-gray-600 hover:bg-gray-100 rounded-lg">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    <h2 class="text-xl font-bold text-gray-800 capitalize hidden sm:block">{{ view }}</h2>
                </div>

                <div class="flex items-center gap-3 md:gap-6">
                    <div class="relative">
                        <button @click="showNotifs = !showNotifs" class="p-2 text-gray-400 hover:text-[#714B67] transition relative">
                            <i class="fas fa-bell text-xl"></i>
                            <span v-if="notifs.length > 0" class="absolute top-1 right-1 w-4 h-4 bg-red-500 text-white text-[10px] font-bold flex items-center justify-center rounded-full border-2 border-white">{{ notifs.length }}</span>
                        </button>
                        
                        <div v-if="showNotifs" class="absolute right-0 mt-2 w-80 bg-white rounded-xl shadow-2xl border border-gray-100 overflow-hidden z-50 animate-fade-in-up">
                            <div class="p-3 bg-gray-50 border-b flex justify-between items-center">
                                <span class="text-xs font-bold text-gray-500 uppercase">Notifications</span>
                                <button @click="notifs = []; showNotifs = false" class="text-[10px] text-[#00A09D] font-bold hover:underline">Clear All</button>
                            </div>
                            <div class="max-h-64 overflow-y-auto">
                                <div v-if="notifs.length === 0" class="p-8 text-center text-gray-400 text-sm">No new notifications</div>
                                <div v-for="(n, idx) in notifs" :key="idx" class="p-4 border-b hover:bg-gray-50 transition">
                                    <p class="text-sm font-bold text-gray-800">{{ n.title }}</p>
                                    <p class="text-xs text-gray-500 mt-1">{{ n.msg }}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button @click="showChat = !showChat" class="p-2 text-gray-400 hover:text-[#00A09D] transition relative">
                        <i class="fas fa-comment-alt text-xl"></i>
                        <span v-if="messages.length > 0" class="absolute top-1 right-1 w-2 h-2 bg-green-500 rounded-full"></span>
                    </button>

                    <button v-if="['sales','inventory','users','expenses'].includes(view)" @click="openActionModal" class="bg-[#714B67] hover:bg-[#5a3c52] text-white px-4 py-2 rounded-lg text-sm font-bold shadow-md shadow-purple-900/10 transition flex items-center gap-2">
                        <i class="fas fa-plus"></i> <span class="hidden sm:inline">Create New</span>
                    </button>
                </div>
            </header>

            <div class="flex-1 p-4 md:p-8 overflow-x-hidden">
                
                <div v-if="view === 'dashboard'" class="space-y-6">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div v-if="session.role === 'Admin'" class="bg-white p-5 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition">
                            <div class="flex justify-between items-start mb-4">
                                <div class="p-2 bg-purple-50 rounded-lg text-[#714B67]"><i class="fas fa-wallet"></i></div>
                                <span class="text-[10px] font-bold uppercase text-gray-400 bg-gray-50 px-2 py-1 rounded">Total Value</span>
                            </div>
                            <h3 class="text-2xl font-black text-gray-800">₦{{ formatMoney(18500000) }}</h3>
                            <p class="text-xs text-gray-500 mt-1">Current inventory valuation</p>
                        </div>

                        <div class="bg-white p-5 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition relative overflow-hidden">
                            <div v-if="lowStockProducts.length > 0" class="absolute right-0 top-0 w-16 h-16 bg-red-500/10 rounded-bl-full -mr-8 -mt-8"></div>
                            <div class="flex justify-between items-start mb-4">
                                <div class="p-2 bg-red-50 rounded-lg text-red-500"><i class="fas fa-exclamation-triangle"></i></div>
                                <span class="text-[10px] font-bold uppercase text-gray-400 bg-gray-50 px-2 py-1 rounded">Alerts</span>
                            </div>
                            <h3 class="text-2xl font-black text-gray-800">{{ lowStockProducts.length }}</h3>
                            <p class="text-xs text-red-500 font-bold mt-1">Low stock items require attention</p>
                        </div>

                        <div class="bg-white p-5 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition">
                            <div class="flex justify-between items-start mb-4">
                                <div class="p-2 bg-teal-50 rounded-lg text-[#00A09D]"><i class="fas fa-cash-register"></i></div>
                                <span class="text-[10px] font-bold uppercase text-gray-400 bg-gray-50 px-2 py-1 rounded">Daily</span>
                            </div>
                            <h3 class="text-2xl font-black text-gray-800">₦{{ formatMoney(todaySales) }}</h3>
                            <p class="text-xs text-gray-500 mt-1">Sales recorded today</p>
                        </div>
                        
                        <div class="bg-white p-5 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition">
                            <div class="flex justify-between items-start mb-4">
                                <div class="p-2 bg-blue-50 rounded-lg text-blue-500"><i class="fas fa-file-invoice"></i></div>
                                <span class="text-[10px] font-bold uppercase text-gray-400 bg-gray-50 px-2 py-1 rounded">Orders</span>
                            </div>
                            <h3 class="text-2xl font-black text-gray-800">{{ orders.length }}</h3>
                            <p class="text-xs text-gray-500 mt-1">Total active orders</p>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden">
                        <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/50">
                            <h3 class="font-bold text-gray-700">Recent Sales Orders</h3>
                            <button @click="view = 'sales'" class="text-xs font-bold text-[#00A09D] hover:underline">View All</button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead class="bg-gray-50 text-xs uppercase font-bold text-gray-400">
                                    <tr>
                                        <th class="p-4">Reference</th>
                                        <th class="p-4">Customer</th>
                                        <th class="p-4">Amount</th>
                                        <th class="p-4">Date</th>
                                        <th class="p-4">Status</th>
                                    </tr>
                                </thead>
                                <tbody class="text-sm divide-y divide-gray-100">
                                    <tr v-for="o in orders.slice(0, 5)" :key="o.id" class="hover:bg-gray-50 transition">
                                        <td class="p-4 font-bold text-[#714B67]">{{ o.id }}</td>
                                        <td class="p-4 font-medium text-gray-700">{{ o.customer }}</td>
                                        <td class="p-4 font-bold text-gray-800">₦{{ formatMoney(o.total) }}</td>
                                        <td class="p-4 text-gray-500 text-xs">{{ formatDate(o.created_at) }}</td>
                                        <td class="p-4">
                                            <span :class="statusClass(o.status)" class="px-2 py-1 rounded-full text-[10px] font-black uppercase tracking-wide">{{ o.status }}</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div v-if="view === 'inventory'" class="bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden">
                    <div class="p-5 border-b border-gray-100 bg-gray-50/50">
                        <h3 class="font-bold text-gray-700">Inventory Management</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50 text-xs font-bold uppercase text-gray-400">
                                <tr>
                                    <th class="p-4">Product Name</th>
                                    <th class="p-4">Category</th>
                                    <th class="p-4">Stock Level</th>
                                    <th class="p-4 text-right">Unit Price</th>
                                    <th class="p-4 text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="text-sm divide-y divide-gray-100">
                                <tr v-for="(p, index) in products" :key="index" class="hover:bg-gray-50 transition">
                                    <td class="p-4 font-bold text-gray-800">{{ p.name }}</td>
                                    <td class="p-4">
                                        <span class="px-2 py-1 bg-gray-100 rounded text-xs font-bold text-gray-500 uppercase">{{ p.category }}</span>
                                    </td>
                                    <td class="p-4">
                                        <div class="flex items-center gap-2">
                                            <div class="w-2 h-2 rounded-full" :class="p.stock < 20 ? 'bg-red-500 animate-pulse' : 'bg-green-500'"></div>
                                            <span :class="p.stock < 20 ? 'text-red-600 font-bold' : 'text-gray-700 font-medium'">{{ p.stock }} {{ p.unit }}</span>
                                        </div>
                                    </td>
                                    <td class="p-4 text-right font-mono text-gray-600">₦{{ formatMoney(p.price) }}</td>
                                    <td class="p-4 text-center">
                                        <div class="flex items-center justify-center gap-2">
                                            <button @click="editProduct(p)" class="p-2 text-[#00A09D] hover:bg-teal-50 rounded transition" title="Edit">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button v-if="['Admin', 'Store'].includes(session.role)" @click="deleteProduct(index)" class="p-2 text-red-500 hover:bg-red-50 rounded transition" title="Delete">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div v-if="view === 'sales'" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div v-for="st in ['quotation','confirmed','delivered']" :key="st" class="flex flex-col h-full">
                            <div class="flex items-center justify-between mb-4 px-1">
                                <h4 class="text-xs font-black uppercase text-gray-500 tracking-wider">{{ st }}</h4>
                                <span class="bg-gray-200 text-gray-600 text-[10px] font-bold px-2 py-0.5 rounded-full">{{ orders.filter(x => x.status === st).length }}</span>
                            </div>
                            
                            <div class="bg-gray-100/50 rounded-xl p-3 space-y-3 min-h-[200px]">
                                <div v-if="orders.filter(x => x.status === st).length === 0" class="text-center py-8 text-gray-400 text-xs italic">No orders</div>
                                
                                <div v-for="o in orders.filter(x => x.status === st)" :key="o.id" class="bg-white p-4 rounded-lg shadow-sm border border-gray-100 hover:shadow-md transition group cursor-pointer">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="text-[10px] font-bold text-gray-400 bg-gray-50 px-1.5 py-0.5 rounded border">{{ o.id }}</span>
                                        <span class="text-[10px] text-gray-400">{{ formatDate(o.created_at) }}</span>
                                    </div>
                                    <h5 class="font-bold text-gray-800 text-sm mb-1">{{ o.customer }}</h5>
                                    <div class="flex justify-between items-end mt-3">
                                        <span class="font-black text-[#714B67]">₦{{ formatMoney(o.total) }}</span>
                                        
                                        <div class="opacity-100 md:opacity-0 group-hover:opacity-100 transition-opacity">
                                            <button v-if="o.status === 'quotation'" @click.stop="updateOrderStatus(o,'confirmed')" class="text-[10px] bg-[#00A09D] text-white px-2 py-1 rounded font-bold hover:bg-teal-700">Confirm</button>
                                            <button v-if="o.status === 'confirmed'" @click.stop="updateOrderStatus(o,'delivered')" class="text-[10px] bg-[#714B67] text-white px-2 py-1 rounded font-bold hover:bg-purple-800">Deliver</button>
                                            <span v-if="o.status === 'delivered'" class="text-green-500"><i class="fas fa-check-circle"></i></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-if="view === 'expenses'" class="space-y-6">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="bg-white p-5 rounded-xl border border-gray-100 shadow-sm">
                            <div class="flex justify-between items-start mb-4">
                                <div class="p-2 bg-red-50 rounded-lg text-red-500"><i class="fas fa-money-bill-wave"></i></div>
                                <span class="text-[10px] font-bold uppercase text-gray-400 bg-gray-50 px-2 py-1 rounded">Total</span>
                            </div>
                            <h3 class="text-2xl font-black text-gray-800">₦{{ formatMoney(totalExpenses) }}</h3>
                            <p class="text-xs text-gray-500 mt-1">All recorded expenses</p>
                        </div>

                        <div class="bg-white p-5 rounded-xl border border-gray-100 shadow-sm">
                            <div class="flex justify-between items-start mb-4">
                                <div class="p-2 bg-orange-50 rounded-lg text-orange-500"><i class="fas fa-calendar-day"></i></div>
                                <span class="text-[10px] font-bold uppercase text-gray-400 bg-gray-50 px-2 py-1 rounded">Today</span>
                            </div>
                            <h3 class="text-2xl font-black text-gray-800">₦{{ formatMoney(todayExpenses) }}</h3>
                            <p class="text-xs text-gray-500 mt-1">Expenses recorded today</p>
                        </div>

                        <div class="bg-white p-5 rounded-xl border border-gray-100 shadow-sm">
                            <div class="flex justify-between items-start mb-4">
                                <div class="p-2 bg-purple-50 rounded-lg text-purple-500"><i class="fas fa-list"></i></div>
                                <span class="text-[10px] font-bold uppercase text-gray-400 bg-gray-50 px-2 py-1 rounded">Count</span>
                            </div>
                            <h3 class="text-2xl font-black text-gray-800">{{ expenses.length }}</h3>
                            <p class="text-xs text-gray-500 mt-1">Total expense records</p>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden">
                        <div class="p-5 border-b border-gray-100 bg-gray-50/50">
                            <h3 class="font-bold text-gray-700">Expense Records</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead class="bg-gray-50 text-xs font-bold uppercase text-gray-400">
                                    <tr>
                                        <th class="p-4">Date</th>
                                        <th class="p-4">Category</th>
                                        <th class="p-4">Description</th>
                                        <th class="p-4 text-right">Amount</th>
                                        <th class="p-4 text-center">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="text-sm divide-y divide-gray-100">
                                    <tr v-if="expenses.length === 0">
                                        <td colspan="5" class="p-8 text-center text-gray-400 italic">No expenses recorded yet</td>
                                    </tr>
                                    <tr v-for="(e, idx) in expenses" :key="idx" class="hover:bg-gray-50 transition">
                                        <td class="p-4 text-gray-600 text-xs">{{ formatDate(e.date) }}</td>
                                        <td class="p-4">
                                            <span class="px-2 py-1 bg-orange-100 text-orange-700 rounded text-xs font-bold uppercase">{{ e.category }}</span>
                                        </td>
                                        <td class="p-4 font-medium text-gray-700">{{ e.description }}</td>
                                        <td class="p-4 text-right font-mono font-bold text-red-600">₦{{ formatMoney(e.amount) }}</td>
                                        <td class="p-4 text-center">
                                            <button @click="deleteExpense(idx)" class="p-2 text-red-500 hover:bg-red-50 rounded transition" title="Delete">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div v-if="view === 'users'" class="bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden">
                    <div class="p-5 border-b border-gray-100 bg-gray-50/50">
                        <h3 class="font-bold text-gray-700">System Users</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50 text-xs font-bold uppercase text-gray-400">
                                <tr>
                                    <th class="p-4">User Profile</th>
                                    <th class="p-4">Username</th>
                                    <th class="p-4">Role</th>
                                    <th class="p-4 text-center">Status</th>
                                    <th class="p-4 text-center">Action</th>
                                </tr>
                            </thead>
                            <tbody class="text-sm divide-y divide-gray-100">
                                <tr v-for="(u, idx) in users" :key="idx" class="hover:bg-gray-50 transition">
                                    <td class="p-4">
                                        <div class="flex items-center gap-3">
                                            <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-xs font-bold text-gray-600">{{ u.fullname.charAt(0) }}</div>
                                            <span class="font-bold text-gray-800">{{ u.fullname }}</span>
                                        </div>
                                    </td>
                                    <td class="p-4 font-mono text-gray-600 text-xs">{{ u.username }}</td>
                                    <td class="p-4">
                                        <span :class="{'bg-purple-100 text-purple-700': u.role==='Admin', 'bg-teal-100 text-teal-700': u.role==='Sales', 'bg-orange-100 text-orange-700': u.role==='Store'}" class="px-2 py-1 rounded text-[10px] font-bold uppercase">{{ u.role }}</span>
                                    </td>
                                    <td class="p-4 text-center">
                                        <span class="w-2 h-2 rounded-full bg-green-500 inline-block mr-1"></span>
                                        <span class="text-xs text-gray-500">Active</span>
                                    </td>
                                    <td class="p-4 text-center">
                                        <button @click="deleteUser(idx)" class="text-red-400 hover:text-red-600 transition"><i class="fas fa-trash-alt"></i></button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div v-if="view === 'reports'" class="space-y-6">
                    <div class="bg-white p-6 rounded-xl border border-gray-100 shadow-sm">
                        <h3 class="font-bold text-gray-700 mb-4 border-b pb-2">Generate Sales Report</h3>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                            <div>
                                <label class="block text-[10px] font-bold uppercase text-gray-400 mb-1">Product</label>
                                <select v-model="report.product" class="w-full border border-gray-200 p-2.5 rounded-lg text-sm bg-gray-50 focus:ring-2 focus:ring-[#00A09D] outline-none">
                                    <option value="__all__">All Products</option>
                                    <option v-for="p in products" :key="p.name" :value="p.name">{{ p.name }}</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold uppercase text-gray-400 mb-1">Date From</label>
                                <input type="date" v-model="report.date_from" class="w-full border border-gray-200 p-2.5 rounded-lg text-sm bg-gray-50 focus:ring-2 focus:ring-[#00A09D] outline-none">
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold uppercase text-gray-400 mb-1">Date To</label>
                                <input type="date" v-model="report.date_to" class="w-full border border-gray-200 p-2.5 rounded-lg text-sm bg-gray-50 focus:ring-2 focus:ring-[#00A09D] outline-none">
                            </div>
                            <button @click="generateReport" class="bg-[#00A09D] hover:bg-teal-700 text-white p-2.5 rounded-lg font-bold text-sm transition shadow-md shadow-teal-900/10">
                                <i class="fas fa-filter mr-2"></i> Generate Data
                            </button>
                        </div>
                    </div>

                    <div class="bg-white p-8 rounded-xl border border-gray-100 shadow-sm min-h-[400px] relative">
                        <div class="flex justify-between items-start border-b-2 border-gray-800 pb-6 mb-8">
                            <div>
                                <h1 class="text-3xl font-black uppercase text-[#714B67] tracking-tighter">Ladu Investment</h1>
                                <p class="text-sm text-gray-500 font-medium tracking-wide">Construction Materials & Equipment ERP</p>
                            </div>
                            <div class="text-right text-xs text-gray-500">
                                <p>Generated: {{ formatDate(new Date().toISOString()) }}</p>
                                <p>Ref: #RPT-{{ Math.floor(1000 + Math.random()*9000) }}</p>
                            </div>
                        </div>

                        <h2 class="text-center font-bold uppercase text-lg mb-8 tracking-widest underline decoration-2 decoration-[#00A09D] underline-offset-4">Sales Performance Report</h2>

                        <div v-if="reportResults.totalQty === 0" class="text-center py-12 bg-gray-50 rounded-lg border border-dashed border-gray-300">
                            <i class="fas fa-search text-4xl text-gray-300 mb-3"></i>
                            <p class="text-gray-500 font-medium">No data found for the selected criteria.</p>
                        </div>

                        <div v-else>
                            <table class="w-full text-sm border border-gray-200">
                                <thead class="bg-gray-100 text-gray-700">
                                    <tr>
                                        <th class="p-3 border border-gray-200 text-left">Item Description</th>
                                        <th class="p-3 border border-gray-200 text-center">Quantity Sold</th>
                                        <th class="p-3 border border-gray-200 text-right">Total Revenue</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="r in reportResults.items" :key="r.name">
                                        <td class="p-3 border border-gray-200 font-medium">{{ r.name }}</td>
                                        <td class="p-3 border border-gray-200 text-center">{{ r.qty }}</td>
                                        <td class="p-3 border border-gray-200 text-right font-mono">₦{{ formatMoney(r.amount) }}</td>
                                    </tr>
                                    <tr class="bg-gray-50 font-bold text-gray-800">
                                        <td colspan="2" class="p-3 border border-gray-200 text-right uppercase text-xs tracking-wider">Grand Total</td>
                                        <td class="p-3 border border-gray-200 text-right font-mono text-lg">₦{{ formatMoney(reportResults.totalAmount) }}</td>
                                    </tr>
                                </tbody>
                            </table>
                            
                            <div class="mt-8 flex justify-end gap-3 print:hidden">
                                <button @click="exportReport('PDF')" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded font-bold text-xs uppercase tracking-wide shadow-md"><i class="fas fa-file-pdf mr-2"></i> Download PDF</button>
                                <button @click="exportReport('Excel')" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-bold text-xs uppercase tracking-wide shadow-md"><i class="fas fa-file-excel mr-2"></i> Export Excel</button>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl border border-gray-100 shadow-sm">
                        <h3 class="font-bold text-gray-700 mb-4 border-b pb-2">Generate Expenses Report</h3>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                            <div>
                                <label class="block text-[10px] font-bold uppercase text-gray-400 mb-1">Category</label>
                                <select v-model="expenseReport.category" class="w-full border border-gray-200 p-2.5 rounded-lg text-sm bg-gray-50 focus:ring-2 focus:ring-[#00A09D] outline-none">
                                    <option value="__all__">All Categories</option>
                                    <option value="Transport">Transport</option>
                                    <option value="Utilities">Utilities</option>
                                    <option value="Salaries">Salaries</option>
                                    <option value="Maintenance">Maintenance</option>
                                    <option value="Office">Office</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold uppercase text-gray-400 mb-1">Date From</label>
                                <input type="date" v-model="expenseReport.date_from" class="w-full border border-gray-200 p-2.5 rounded-lg text-sm bg-gray-50 focus:ring-2 focus:ring-[#00A09D] outline-none">
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold uppercase text-gray-400 mb-1">Date To</label>
                                <input type="date" v-model="expenseReport.date_to" class="w-full border border-gray-200 p-2.5 rounded-lg text-sm bg-gray-50 focus:ring-2 focus:ring-[#00A09D] outline-none">
                            </div>
                            <button @click="generateExpenseReport" class="bg-[#714B67] hover:bg-purple-800 text-white p-2.5 rounded-lg font-bold text-sm transition shadow-md shadow-purple-900/10">
                                <i class="fas fa-filter mr-2"></i> Generate Report
                            </button>
                        </div>
                    </div>

                    <div class="bg-white p-8 rounded-xl border border-gray-100 shadow-sm min-h-[400px]">
                        <div class="flex justify-between items-start border-b-2 border-gray-800 pb-6 mb-8">
                            <div>
                                <h1 class="text-3xl font-black uppercase text-[#714B67] tracking-tighter">Ladu Investment</h1>
                                <p class="text-sm text-gray-500 font-medium tracking-wide">Construction Materials & Equipment ERP</p>
                            </div>
                            <div class="text-right text-xs text-gray-500">
                                <p>Generated: {{ formatDate(new Date().toISOString()) }}</p>
                                <p>Ref: #EXP-{{ Math.floor(1000 + Math.random()*9000) }}</p>
                            </div>
                        </div>

                        <h2 class="text-center font-bold uppercase text-lg mb-8 tracking-widest underline decoration-2 decoration-red-500 underline-offset-4">Expenses Report</h2>

                        <div v-if="expenseReportResults.items.length === 0" class="text-center py-12 bg-gray-50 rounded-lg border border-dashed border-gray-300">
                            <i class="fas fa-search text-4xl text-gray-300 mb-3"></i>
                            <p class="text-gray-500 font-medium">No expense data found for the selected criteria.</p>
                        </div>

                        <div v-else>
                            <table class="w-full text-sm border border-gray-200">
                                <thead class="bg-gray-100 text-gray-700">
                                    <tr>
                                        <th class="p-3 border border-gray-200 text-left">Date</th>
                                        <th class="p-3 border border-gray-200 text-left">Category</th>
                                        <th class="p-3 border border-gray-200 text-left">Description</th>
                                        <th class="p-3 border border-gray-200 text-right">Amount</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="e in expenseReportResults.items" :key="e.id">
                                        <td class="p-3 border border-gray-200">{{ formatDate(e.date) }}</td>
                                        <td class="p-3 border border-gray-200 font-medium">{{ e.category }}</td>
                                        <td class="p-3 border border-gray-200">{{ e.description }}</td>
                                        <td class="p-3 border border-gray-200 text-right font-mono text-red-600">₦{{ formatMoney(e.amount) }}</td>
                                    </tr>
                                    <tr class="bg-gray-50 font-bold text-gray-800">
                                        <td colspan="3" class="p-3 border border-gray-200 text-right uppercase text-xs tracking-wider">Total Expenses</td>
                                        <td class="p-3 border border-gray-200 text-right font-mono text-lg text-red-600">₦{{ formatMoney(expenseReportResults.total) }}</td>
                                    </tr>
                                </tbody>
                            </table>
                            
                            <div class="mt-8 flex justify-end gap-3 print:hidden">
                                <button @click="exportExpenseReport('PDF')" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded font-bold text-xs uppercase tracking-wide shadow-md"><i class="fas fa-file-pdf mr-2"></i> Download PDF</button>
                                <button @click="exportExpenseReport('Excel')" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-bold text-xs uppercase tracking-wide shadow-md"><i class="fas fa-file-excel mr-2"></i> Export Excel</button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- CHAT WIDGET -->
    <div v-if="session && showChat" class="fixed right-4 bottom-4 w-80 bg-white shadow-2xl rounded-t-xl border border-gray-200 z-50 flex flex-col overflow-hidden animate-fade-in-up">
        <div class="p-3 bg-[#714B67] text-white flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                <span class="font-bold text-xs uppercase tracking-wide">Team Chat</span>
            </div>
            <button @click="showChat = false" class="text-white/70 hover:text-white"><i class="fas fa-times"></i></button>
        </div>
        <div class="h-64 bg-gray-50 p-4 overflow-y-auto space-y-3 flex flex-col">
            <div v-for="(m, idx) in messages" :key="idx" :class="m.from === session.fullname ? 'self-end bg-[#00A09D] text-white rounded-tr-none' : 'self-start bg-white text-gray-700 border border-gray-200 rounded-tl-none'" class="p-2.5 rounded-xl text-xs max-w-[85%] shadow-sm">
                <p class="font-bold text-[9px] uppercase mb-1 opacity-70">{{ m.from }}</p>
                {{ m.text }}
            </div>
        </div>
        <div class="p-2 border-t bg-white flex gap-2">
            <input v-model="newMessage" @keyup.enter="sendMessage" type="text" placeholder="Type a message..." class="flex-1 text-xs border border-gray-200 rounded-lg p-2 outline-none focus:border-[#00A09D]">
            <button @click="sendMessage" class="bg-[#00A09D] text-white px-3 rounded-lg hover:bg-teal-700 transition"><i class="fas fa-paper-plane text-xs"></i></button>
        </div>
    </div>

    <!-- CREATE/EDIT MODAL -->
    <div v-if="modal.show" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[60] flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-lg rounded-xl shadow-2xl overflow-hidden animate-fade-in-up">
            <div class="p-5 bg-[#714B67] text-white flex justify-between items-center">
                <h3 class="font-bold uppercase tracking-widest text-sm flex items-center gap-2">
                    <i class="fas fa-edit"></i> {{ modal.isEdit ? 'Update' : 'Create New' }} {{ view === 'users' ? 'User' : view === 'expenses' ? 'Expense' : view.slice(0,1).toUpperCase() + view.slice(1) }}
                </h3>
                <button @click="modal.show = false" class="text-white/70 hover:text-white transition"><i class="fas fa-times text-lg"></i></button>
            </div>
            
            <div class="p-6 space-y-4 max-h-[80vh] overflow-y-auto">
                <div v-if="view === 'sales'" class="space-y-4">
                    <div>
                        <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Customer Name</label>
                        <input v-model="form.customer" type="text" class="w-full border border-gray-300 p-3 rounded-lg bg-gray-50 focus:ring-2 focus:ring-[#00A09D] outline-none text-sm" placeholder="e.g. Julius Berger">
                    </div>
                    
                    <div>
                        <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Product Item</label>
                        <select v-model="form.itemName" class="w-full border border-gray-300 p-3 rounded-lg bg-gray-50 focus:ring-2 focus:ring-[#00A09D] outline-none text-sm">
                            <option value="" disabled>Select a product</option>
                            <option v-for="p in products" :key="p.name" :value="p.name">{{ p.name }} (₦{{ formatMoney(p.price) }})</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Total Amount (₦)</label>
                            <input v-model.number="form.total" type="number" class="w-full border border-gray-300 p-3 rounded-lg bg-gray-50 focus:ring-2 focus:ring-[#00A09D] outline-none text-sm">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Initial Status</label>
                            <select v-model="form.status" class="w-full border border-gray-300 p-3 rounded-lg bg-gray-50 focus:ring-2 focus:ring-[#00A09D] outline-none text-sm">
                                <option value="quotation">Quotation</option>
                                <option value="confirmed">Confirmed</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div v-if="view === 'inventory'" class="space-y-4">
                    <div>
                        <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Product Name</label>
                        <input v-model="form.pName" type="text" class="w-full border border-gray-300 p-3 rounded-lg bg-gray-50 focus:ring-2 focus:ring-[#00A09D] outline-none text-sm">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Stock Quantity</label>
                            <input v-model.number="form.stock" type="number" class="w-full border border-gray-300 p-3 rounded-lg bg-gray-50 focus:ring-2 focus:ring-[#00A09D] outline-none text-sm">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Unit Price (₦)</label>
                            <input v-model.number="form.price" type="number" class="w-full border border-gray-300 p-3 rounded-lg bg-gray-50 focus:ring-2 focus:ring-[#00A09D] outline-none text-sm">
                        </div>
                    </div>
                </div>

                <div v-if="view === 'expenses'" class="space-y-4">
                    <div>
                        <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Expense Category</label>
                        <select v-model="form.expCategory" class="w-full border border-gray-300 p-3 rounded-lg bg-gray-50 focus:ring-2 focus:ring-[#00A09D] outline-none text-sm">
                            <option value="" disabled>Select category</option>
                            <option value="Transport">Transport</option>
                            <option value="Utilities">Utilities</option>
                            <option value="Salaries">Salaries</option>
                            <option value="Maintenance">Maintenance</option>
                            <option value="Office">Office</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Description</label>
                        <textarea v-model="form.expDescription" rows="3" class="w-full border border-gray-300 p-3 rounded-lg bg-gray-50 focus:ring-2 focus:ring-[#00A09D] outline-none text-sm resize-none" placeholder="Describe the expense..."></textarea>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Amount (₦)</label>
                            <input v-model.number="form.expAmount" type="number" class="w-full border border-gray-300 p-3 rounded-lg bg-gray-50 focus:ring-2 focus:ring-[#00A09D] outline-none text-sm">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Date</label>
                            <input v-model="form.expDate" type="date" class="w-full border border-gray-300 p-3 rounded-lg bg-gray-50 focus:ring-2 focus:ring-[#00A09D] outline-none text-sm">
                        </div>
                    </div>
                </div>

                <div v-if="view === 'users'" class="space-y-4">
                    <div>
                        <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Full Name</label>
                        <input v-model="form.uFullname" type="text" class="w-full border border-gray-300 p-3 rounded-lg bg-gray-50 focus:ring-2 focus:ring-[#00A09D] outline-none text-sm">
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Username</label>
                        <input v-model="form.uUsername" type="text" class="w-full border border-gray-300 p-3 rounded-lg bg-gray-50 focus:ring-2 focus:ring-[#00A09D] outline-none text-sm" placeholder="unique username">
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Password</label>
                        <input v-model="form.uPassword" type="password" class="w-full border border-gray-300 p-3 rounded-lg bg-gray-50 focus:ring-2 focus:ring-[#00A09D] outline-none text-sm">
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Role</label>
                        <select v-model="form.uRole" class="w-full border border-gray-300 p-3 rounded-lg bg-gray-50 focus:ring-2 focus:ring-[#00A09D] outline-none text-sm">
                            <option value="Admin">Admin</option>
                            <option value="Sales">Sales</option>
                            <option value="Store">Store</option>
                        </select>
                    </div>
                    <div v-if="modal.userError" class="p-3 bg-red-50 text-red-600 text-xs font-bold rounded flex items-center gap-2">
                        <i class="fas fa-exclamation-circle"></i> {{ modal.userError }}
                    </div>
                </div>

                <button @click="submitRecord" class="w-full py-3.5 bg-[#00A09D] hover:bg-teal-700 text-white rounded-lg font-bold uppercase tracking-widest shadow-lg shadow-teal-900/20 transition transform active:scale-95 mt-4">
                    {{ modal.isEdit ? 'Update Record' : 'Save Record' }}
                </button>
            </div>
        </div>
    </div>

    <!-- RECEIPT PRINT AREA (HIDDEN) -->
    <div id="printReceipt" style="display: none;"></div>

</div>

<script>
    const { createApp } = Vue;
    createApp({
        data() {
            return {
                session: null,
                view: 'dashboard',
                sidebarOpen: false,
                showNotifs: false, 
                showChat: false,
                modal: { show: false, isEdit: false, activeIndex: null, userError: '' },
                newMessage: '',
                form: { 
                    customer: '', total: 0, status: 'quotation', itemName: '', 
                    pName: '', stock: 0, price: 0, 
                    uFullname: '', uUsername: '', uPassword: '', uRole: 'Sales',
                    expCategory: '', expDescription: '', expAmount: 0, expDate: new Date().toISOString().slice(0,10)
                },
                roleLogin: { show: false, role: null, username: '', password: '', error: '' },

                users: [
                    { fullname: 'Administrator', username: 'admin123', password: '1234', role: 'Admin' },
                    { fullname: 'Sales User', username: 'sale123', password: '1234', role: 'Sales' },
                    { fullname: 'Store User', username: 'store123', password: '1234', role: 'Store' }
                ],

                notifs: [
                    { title: 'Stock Alert', msg: '10mm Steel Rod is below 10 bundles!' },
                    { title: 'Payment Received', msg: 'SO003 payment confirmed by Admin.' }
                ],
                messages: [
                    { from: 'Musa Ibrahim', text: 'Truck for Cement arrived at gate.' },
                    { from: 'Kemi Adebayo', text: 'Preparing quotation for Site C project.' }
                ],

                products: [
                    { name: 'Dangote Cement (50kg)', category: 'Cement', stock: 450, unit: 'bags', price: 8500 },
                    { name: '10mm Steel Rod', category: 'Rods', stock: 8, unit: 'bundles', price: 720000 },
                    { name: 'River Sand (per ton)', category: 'Aggregates', stock: 65, unit: 'tons', price: 18000 },
                    { name: 'Granite (3/4 inch)', category: 'Aggregates', stock: 120, unit: 'tons', price: 22000 },
                    { name: 'Royal Tiles 60x60', category: 'Finishing', stock: 200, unit: 'sqm', price: 9500 }
                ],

                orders: [
                    { id: 'SO001', customer: 'Julius Berger', items: [{name:'Dangote Cement (50kg)', qty:150, amount:1275000}], total: 1275000, status: 'confirmed', created_at: '2026-01-18' },
                    { id: 'SO002', customer: 'Alhaji Gafar', items: [{name:'10mm Steel Rod', qty:2, amount:1900000}], total: 1900000, status: 'quotation', created_at: '2026-01-20' },
                    { id: 'SO003', customer: 'M. Construction', items: [{name:'Dangote Cement (50kg)', qty:50, amount:425000}], total: 425000, status: 'delivered', created_at: '2026-01-12' },
                    { id: 'SO004', customer: 'Lekki Gardens', items: [{name:'River Sand', qty:20, amount:360000}], total: 360000, status: 'quotation', created_at: '2026-01-21' }
                ],

                expenses: [
                    { date: '2026-01-15', category: 'Transport', description: 'Fuel for delivery trucks', amount: 45000 },
                    { date: '2026-01-18', category: 'Utilities', description: 'Electricity bill for warehouse', amount: 28000 },
                    { date: '2026-01-20', category: 'Salaries', description: 'Staff salaries for January', amount: 350000 }
                ],

                report: { product: '__all__', date_from: '', date_to: ''},
                reportResults: { items: [], totalQty: 0, totalAmount: 0 },

                expenseReport: { category: '__all__', date_from: '', date_to: '' },
                expenseReportResults: { items: [], total: 0 }
            }
        },
        computed: {
            lowStockProducts() { return this.products.filter(p => p.stock < 20); },
            todaySales() {
                const today = new Date().toISOString().slice(0,10);
                return this.orders.filter(o => o.created_at === today).reduce((s,o)=>s+o.total,0);
            },
            totalExpenses() {
                return this.expenses.reduce((sum, e) => sum + e.amount, 0);
            },
            todayExpenses() {
                const today = new Date().toISOString().slice(0,10);
                return this.expenses.filter(e => e.date === today).reduce((sum, e) => sum + e.amount, 0);
            }
        },
        methods: {
            openRoleLogin(role) {
                this.roleLogin.show = true;
                this.roleLogin.role = role;
                this.roleLogin.username = '';
                this.roleLogin.password = '';
                this.roleLogin.error = '';
            },
            closeRoleLogin() {
                this.roleLogin.show = false;
                this.roleLogin.role = null;
                this.roleLogin.error = '';
            },
            attemptRoleLogin() {
                this.roleLogin.error = '';
                const u = this.users.find(x => x.username === this.roleLogin.username && x.password === this.roleLogin.password && x.role === this.roleLogin.role);
                if (!u) {
                    this.roleLogin.error = 'Invalid credentials for selected role.';
                    return;
                }
                this.session = { username: u.username, role: u.role, fullname: u.fullname };
                this.roleLogin.show = false;
                this.view = 'dashboard';
                this.sidebarOpen = false;
                this.checkStockAlerts();
            },
            logout() { this.session = null; this.view = 'dashboard'; this.sidebarOpen = false; },

            formatMoney(val) { if (!val && val !== 0) return '0'; return Number(val).toLocaleString(); },
            formatDate(d) { if(!d) return ''; return new Date(d).toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' }); },

            statusClass(s) {
                const map = { quotation: 'bg-gray-100 text-gray-500', confirmed: 'bg-blue-100 text-blue-600', delivered: 'bg-green-100 text-green-600' };
                return map[s] || 'bg-gray-100 text-gray-500';
            },

            openActionModal() {
                this.modal.userError = '';
                this.modal.isEdit = false;
                this.modal.activeIndex = null;
                this.form = { 
                    customer: '', total: 0, status: 'quotation', itemName: '', 
                    pName: '', stock: 0, price: 0, 
                    uFullname: '', uUsername: '', uPassword: '', uRole: 'Sales',
                    expCategory: '', expDescription: '', expAmount: 0, expDate: new Date().toISOString().slice(0,10)
                };
                this.modal.show = true;
            },

            updateOrderStatus(order, next) {
                order.status = next;
                this.notifs.unshift({ title: 'Order Updated', msg: `${order.id} is now ${next}` });
                
                if (next === 'confirmed' && ['Admin', 'Sales'].includes(this.session.role)) {
                    this.downloadReceipt(order);
                }
            },

            downloadReceipt(order) {
                const receiptHTML = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <title>Receipt - ${order.id}</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; }
                            .header { text-align: center; border-bottom: 3px solid #714B67; padding-bottom: 20px; margin-bottom: 30px; }
                            .header h1 { color: #714B67; margin: 0; font-size: 32px; }
                            .header p { color: #666; margin: 5px 0; }
                            .receipt-info { display: flex; justify-content: space-between; margin-bottom: 30px; }
                            .receipt-info div { flex: 1; }
                            .receipt-info strong { display: block; color: #714B67; margin-bottom: 5px; }
                            table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                            th { background: #714B67; color: white; padding: 12px; text-align: left; }
                            td { padding: 12px; border-bottom: 1px solid #ddd; }
                            .total-row { background: #f9f9f9; font-weight: bold; font-size: 18px; }
                            .footer { margin-top: 40px; padding-top: 20px; border-top: 2px solid #ddd; text-align: center; color: #666; font-size: 12px; }
                            .status-badge { display: inline-block; padding: 5px 15px; background: #00A09D; color: white; border-radius: 20px; font-size: 12px; font-weight: bold; text-transform: uppercase; }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h1>LADU INVESTMENT</h1>
                            <p>Construction Materials & Equipment</p>
                            <p style="font-size: 12px; margin-top: 10px;">Address: Lagos, Nigeria | Phone: +234 XXX XXX XXXX | Email: info@laduinvestment.com</p>
                        </div>
                        
                        <div style="text-align: center; margin: 30px 0;">
                            <h2 style="color: #714B67; margin: 0;">SALES RECEIPT</h2>
                            <p style="color: #666; margin: 5px 0;">Receipt No: ${order.id}</p>
                            <span class="status-badge">${order.status}</span>
                        </div>

                        <div class="receipt-info">
                            <div>
                                <strong>Customer Details:</strong>
                                <p>${order.customer}</p>
                            </div>
                            <div style="text-align: right;">
                                <strong>Date:</strong>
                                <p>${this.formatDate(order.created_at)}</p>
                                <strong>Processed By:</strong>
                                <p>${this.session.fullname} (${this.session.role})</p>
                            </div>
                        </div>

                        <table>
                            <thead>
                                <tr>
                                    <th>Item Description</th>
                                    <th style="text-align: center;">Quantity</th>
                                    <th style="text-align: right;">Amount (₦)</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${order.items.map(item => `
                                    <tr>
                                        <td>${item.name}</td>
                                        <td style="text-align: center;">${item.qty}</td>
                                        <td style="text-align: right;">₦${this.formatMoney(item.amount)}</td>
                                    </tr>
                                `).join('')}
                                <tr class="total-row">
                                    <td colspan="2" style="text-align: right;">TOTAL AMOUNT:</td>
                                    <td style="text-align: right;">₦${this.formatMoney(order.total)}</td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="footer">
                            <p><strong>Thank you for your business!</strong></p>
                            <p>This is a computer-generated receipt and does not require a signature.</p>
                            <p>For inquiries, please contact us at the details above.</p>
                            <p style="margin-top: 20px; font-size: 10px;">Generated on ${new Date().toLocaleString()}</p>
                        </div>
                    </body>
                    </html>
                `;

                const printWindow = window.open('', '_blank');
                printWindow.document.write(receiptHTML);
                printWindow.document.close();
                
                setTimeout(() => {
                    printWindow.print();
                }, 500);
            },

            editProduct(p) {
                this.modal.isEdit = true;
                this.modal.activeIndex = this.products.indexOf(p);
                this.form = { pName: p.name, stock: p.stock, price: p.price };
                this.view = 'inventory';
                this.modal.show = true;
            },

            deleteProduct(idx) { if(confirm('Are you sure you want to delete this product?')) this.products.splice(idx,1); },

            deleteExpense(idx) { 
                if(confirm('Are you sure you want to delete this expense record?')) {
                    this.expenses.splice(idx,1);
                    this.notifs.unshift({ title: 'Expense Deleted', msg: 'Expense record has been removed.' });
                }
            },

            deleteUser(idx) { if(confirm('Remove user access?')) this.users.splice(idx,1); },

            sendMessage() {
                if(!this.newMessage.trim()) return;
                this.messages.push({ from: this.session.fullname, text: this.newMessage });
                this.newMessage = '';
            },

            checkStockAlerts() {
                this.lowStockProducts.forEach(p => {
                    const exists = this.notifs.find(n => n.msg.includes(p.name));
                    if (!exists) {
                        this.notifs.unshift({ title: 'Low Stock Alert', msg: `${p.name} only has ${p.stock} remaining!` });
                    }
                });
            },

            exportReport(type) {
                const summary = `Exporting ${type} for ${this.report.product === '__all__' ? 'All Products' : this.report.product} from ${this.report.date_from || 'start'} to ${this.report.date_to || 'end'} — Total: ₦${this.formatMoney(this.reportResults.totalAmount)}`;
                alert(summary);
            },

            exportExpenseReport(type) {
                const summary = `Exporting ${type} for ${this.expenseReport.category === '__all__' ? 'All Categories' : this.expenseReport.category} from ${this.expenseReport.date_from || 'start'} to ${this.expenseReport.date_to || 'end'} — Total: ₦${this.formatMoney(this.expenseReportResults.total)}`;
                alert(summary);
            },

            submitRecord() {
                if (this.view === 'sales') {
                    if (!this.form.customer.trim() || !this.form.itemName || !this.form.total) {
                        alert('Please fill all required fields');
                        return;
                    }
                    const id = 'SO' + Math.floor(1000 + Math.random() * 9000);
                    const created = new Date().toISOString().slice(0,10);
                    const item = { name: this.form.itemName, qty: 1, amount: this.form.total };
                    this.orders.unshift({ id, customer: this.form.customer, items: [item], total: this.form.total, status: this.form.status, created_at: created });
                } else if (this.view === 'inventory') {
                    if (!this.form.pName.trim() || !this.form.stock || !this.form.price) {
                        alert('Please fill all required fields');
                        return;
                    }
                    if (this.modal.isEdit && this.modal.activeIndex !== null) {
                        const p = this.products[this.modal.activeIndex];
                        p.name = this.form.pName; p.stock = this.form.stock; p.price = this.form.price;
                    } else {
                        this.products.unshift({ name: this.form.pName, category: 'General', stock: this.form.stock, unit: 'units', price: this.form.price });
                    }
                } else if (this.view === 'expenses') {
                    if (!this.form.expCategory || !this.form.expDescription.trim() || !this.form.expAmount || !this.form.expDate) {
                        alert('Please fill all required fields');
                        return;
                    }
                    this.expenses.unshift({
                        date: this.form.expDate,
                        category: this.form.expCategory,
                        description: this.form.expDescription,
                        amount: this.form.expAmount
                    });
                    this.notifs.unshift({ title: 'Expense Added', msg: `New ${this.form.expCategory} expense recorded: ₦${this.formatMoney(this.form.expAmount)}` });
                } else if (this.view === 'users') {
                    this.modal.userError = '';
                    if(!this.form.uFullname.trim() || !this.form.uUsername.trim() || !this.form.uPassword.trim()) {
                        this.modal.userError = 'Fullname, username and password are required.';
                        return;
                    }
                    if (this.users.find(u => u.username === this.form.uUsername)) {
                        this.modal.userError = 'Username already exists. Choose another.';
                        return;
                    }
                    this.users.push({ fullname: this.form.uFullname, username: this.form.uUsername, password: this.form.uPassword, role: this.form.uRole });
                }
                this.modal.show = false;
                this.checkStockAlerts();
            },

            generateReport() {
                const from = this.report.date_from ? new Date(this.report.date_from) : null;
                const to = this.report.date_to ? new Date(this.report.date_to) : null;

                const aggr = {};
                let totalQty = 0, totalAmount = 0;
                this.orders.forEach(o => {
                    const d = new Date(o.created_at);
                    if (from && d < from) return;
                    if (to && d > to) return;

                    o.items.forEach(it => {
                        if (this.report.product !== '__all__' && it.name !== this.report.product) return;
                        if (!aggr[it.name]) aggr[it.name] = { name: it.name, qty: 0, amount: 0 };
                        aggr[it.name].qty += it.qty;
                        aggr[it.name].amount += it.amount;
                        totalQty += it.qty;
                        totalAmount += it.amount;
                    });
                });

                this.reportResults.items = Object.values(aggr);
                this.reportResults.totalQty = totalQty;
                this.reportResults.totalAmount = totalAmount;
            },

            generateExpenseReport() {
                const from = this.expenseReport.date_from ? new Date(this.expenseReport.date_from) : null;
                const to = this.expenseReport.date_to ? new Date(this.expenseReport.date_to) : null;

                const filtered = this.expenses.filter(e => {
                    const d = new Date(e.date);
                    if (from && d < from) return false;
                    if (to && d > to) return false;
                    if (this.expenseReport.category !== '__all__' && e.category !== this.expenseReport.category) return false;
                    return true;
                });

                this.expenseReportResults.items = filtered;
                this.expenseReportResults.total = filtered.reduce((sum, e) => sum + e.amount, 0);
            }
        }
    }).mount('#app');
</script>
</body>
</html>
